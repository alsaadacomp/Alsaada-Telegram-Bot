# ๐ข ุฏููู ุงูุฃุฑูุงู ุงูุนุฑุจูุฉ ูุงูุฅุนุฏุงุฏุงุช

## ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุทููุฑ ุงูุจูุช ููุฏุนู **ุงูุฃุฑูุงู ุงูุนุฑุจูุฉ ูุงูุฅูุฌููุฒูุฉ** ูู ุฌููุน ุญููู ุงูุฅุฏุฎุงูุ ูุน **ุนุฑุถ ุงููุจุงูุบ ุจููุงุตู ุงูุขูุงู** ุจุดูู ุงุญุชุฑุงููุ ุจุงูุฅุถุงูุฉ ุฅูู **ููุญุฉ ุฅุนุฏุงุฏุงุช ุดุงููุฉ** ููุณูุจุฑ ุฃุฏูู.

---

## 1๏ธโฃ ุฏุนู ุงูุฃุฑูุงู ุงูุนุฑุจูุฉ ูุงูุฅูุฌููุฒูุฉ

### โจ ุงูููุฒุงุช:

- โ **ูุจูู ุงูุฃุฑูุงู ุงูุนุฑุจูุฉ** (ููกูขูฃูคูฅูฆูงูจูฉ) ูุงูุฅูุฌููุฒูุฉ (0123456789) ูู ุฌููุน ุงูุญููู
- โ **ุชุญููู ุชููุงุฆู** ูู ุงูุนุฑุจูุฉ ููุฅูุฌููุฒูุฉ ูุจู ุงููุนุงูุฌุฉ
- โ **ุฏุนู ุงูููุงุตู** (1,000 ุฃู ูก,ููู)
- โ **ุนุฑุถ ุงูุฃุฑูุงู ุจููุงุตู ุงูุขูุงู** ุจุดูู ุงุญุชุฑุงูู

### ๐ ุงููููุงุช ุงููุชุฃุซุฑุฉ:

#### `src/modules/input/formatters/number-formatter.ts`

ุงููุญุฏุฉ ุงูุฃุณุงุณูุฉ ูุชุญููู ูุชูุณูู ุงูุฃุฑูุงู:

```typescript
// ุชุญููู ุงูุฃุฑูุงู ุงูุนุฑุจูุฉ ููุฅูุฌููุฒูุฉ
normalizeArabicNumbers('ูกูขูฃูคูฅ') // '12345'

// ุนุฑุถ ุงูุฃุฑูุงู ุจููุงุตู
formatNumberWithCommas(1234567) // '1,234,567'

// ุชุญููู ุงูุฃุฑูุงู (ุนุฑุจู/ุฅูุฌููุฒู)
parseNumber('ูก,ูขูฃูค') // 1234
parseNumber('1,234.56') // 1234.56

// ุชูุณูู ุงูุนููุงุช
formatCurrency(1234.5) // '1,234.50'
formatCurrency(1234.5, 'EGP') // '1,234.50 EGP'

// ุงูุชุญูู ูู ุตุญุฉ ุงูุฑูู
isValidNumberString('ูกูขูฃ') // true
isValidNumberString('123.45') // true
```

#### ุงูููุญููุงุช ุงูููุญุฏุซุฉ (Validators):

1. **`number.validator.ts`**: ููุจู ุงูุฃุฑูุงู ุงูุนุฑุจูุฉ ูุงูุฅูุฌููุฒูุฉ
   ```typescript
   isValidNumber('ูกูขูฃ') // true
   isValidNumber('123') // true
   toNumber('ูกูขูฃ') // 123
   ```

2. **`phone.validator.ts`**: ููุจู ุฃุฑูุงู ุงูููุจุงูู ุจุงูุนุฑุจูุฉ ูุงูุฅูุฌููุฒูุฉ
   ```typescript
   isValidEgyptPhone('ููกููกูขูฃูคูฅูฆูงูจ') // true
   isValidEgyptPhone('01012345678') // true
   ```

---

## 2๏ธโฃ ุนุฑุถ ุงููุจุงูุบ ุจููุงุตู ุงูุขูุงู

### ๐ฏ ุงูุงุณุชุฎุฏุงู:

```typescript
import { formatCurrency, formatNumber } from '#root/modules/input/formatters/index.js'

// ูู ุฃู ูุนุงูุฌ
const amount = 1234567
await ctx.reply(`ุงููุจูุบ: ${formatNumber(amount)} ุฌููู`) // ุงููุจูุบ: 1,234,567 ุฌููู

// ูุน ุงูุนููุฉ
await ctx.reply(`ุงูุฅุฌูุงูู: ${formatCurrency(1234.56, 'EGP')}`) // ุงูุฅุฌูุงูู: 1,234.56 EGP
```

### ๐ ุฃูุซูุฉ:

| ุงููุฏุฎู | ุงููุฎุฑุฌ |
|--------|--------|
| `1000` | `1,000` |
| `10000` | `10,000` |
| `100000` | `100,000` |
| `1000000` | `1,000,000` |
| `1234.56` | `1,234.56` |

---

## 3๏ธโฃ ูุธุงู ุงูุฅุนุฏุงุฏุงุช ุงูุดุงูู

### ๐๏ธ ุงููุตูู:

**SUPER_ADMIN ููุท** ูุฑู ุฒุฑ **"โ๏ธ ุงูุฅุนุฏุงุฏุงุช"** ูู ุงูููุจูุฑุฏ ุจุฌุงูุจ "๐ ุงููุงุฆูุฉ ุงูุฑุฆูุณูุฉ".

### ๐ ุฃูุณุงู ุงูุฅุนุฏุงุฏุงุช:

#### 1. **๐ข ุจูุงูุงุช ุงูุดุฑูุฉ**
- โ๏ธ ุชุนุฏูู ุงุณู ุงูุดุฑูุฉ
- ๐ ุจูุงูุงุช ุงูุดุฑูุฉ ุงูุฃุฎุฑู (ูุงุจูุฉ ููุชูุณุน)

**ุงูุงุณุชุฎุฏุงู:**
1. ุงุถุบุท "โ๏ธ ุงูุฅุนุฏุงุฏุงุช"
2. ุงุฎุชุฑ "๐ข ุจูุงูุงุช ุงูุดุฑูุฉ"
3. ุงุฎุชุฑ "โ๏ธ ุชุนุฏูู ุงุณู ุงูุดุฑูุฉ"
4. ุฃุฑุณู ุงูุงุณู ุงูุฌุฏูุฏ
5. โ ูุชู ุงูุญูุธ ุชููุงุฆูุงู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

#### 2. **๐ง ุฅุนุฏุงุฏุงุช ุงูุจูุช**
- ๐ง ูุถุน ุงูุตูุงูุฉ
- ๐ ุฑุณุงูุฉ ุงูุชุฑุญูุจ
- ๐ ุงููุบุฉ ุงูุงูุชุฑุงุถูุฉ

#### 3. **๐ฏ ุชูุนูู/ุฅููุงู ุงูุฃูุณุงู**
- โ ุนุฑุถ ุฌููุน ุงูุฃูุณุงู ูุน ุญุงูุชูุง (ููุนูู/ูุนุทูู)
- ๐ ุงูุถุบุท ุนูู ุฃู ูุณู ูุจุฏู ุญุงูุชู ููุฑุงู
- โก ุงูุชุบููุฑ ููุฑู ุจุฏูู ุฅุนุงุฏุฉ ุชุดุบูู

**ูุซุงู:**
```
โ ูุณู ุชุฌุฑูุจู (ููุนูู)
โ ููุญุฉ ุงูุชุญูู (ููุนูู)
โ ูุณู ุงููุจูุนุงุช (ูุนุทูู)
```

#### 4. **๐ ุฅุนุฏุงุฏุงุช ุงูุฃูุงู**
- ๐ ุญุฏ ุงููุญุงููุงุช (Rate Limit)
- ๐ซ ุงูุญุธุฑ ุงูุชููุงุฆู ุนูุฏ ุงูุณุจุงู
- ๐ ุญุฏ ูุญุงููุงุช ุชุณุฌูู ุงูุฏุฎูู

#### 5. **๐ ุฅุนุฏุงุฏุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช**
- ๐พ ุงููุณุฎ ุงูุงุญุชูุงุทู ุงูุชููุงุฆู
- ๐๏ธ ุญุฏ ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ
- โฐ ูุชุฑุฉ ุงููุณุฎ ุงูุงุญุชูุงุทู

#### 6. **๐ ุฅุนุฏุงุฏุงุช ุงูุณุฌูุงุช**
- ๐ ูุณุชูู ุงูุณุฌูุงุช (debug, info, warn, error)
- ๐พ ุญูุธ ุงูุณุฌูุงุช ูู ููู
- ๐ ุชุณุฌูู ุงุณุชุนูุงูุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช

#### 7. **๐ ุฅุนุฏุงุฏุงุช ุงูุฅุดุนุงุฑุงุช**
- ๐ ุชูุนูู/ุฅููุงู ุงูุฅุดุนุงุฑุงุช
- โก ุงูุฃููููุฉ ุงูุงูุชุฑุงุถูุฉ
- ๐ ุฅุนุงุฏุฉ ุงููุญุงููุฉ ุนูุฏ ุงููุดู

#### 8. **โก ุฅุนุฏุงุฏุงุช ุงูุฃุฏุงุก**
- ๐จ ุชูุนูู ุงููุงุด
- โฑ๏ธ ูุฏุฉ ุงููุงุด
- ๐ ุงูุญุฏ ุงูุฃูุตู ููุทูุจุงุช ุงููุชุฒุงููุฉ

#### 9. **๐ ุฅุนุฏุงุฏุงุช ุงููุบุฉ**
- ๐ ุงููุบุฉ ุงูุงูุชุฑุงุถูุฉ ููุจูุช

---

## ๐๏ธ ุงูุจููุฉ ุงูุชูููุฉ

### ๐ ูููู ุงููููุงุช:

```
src/
โโโ modules/
โ   โโโ input/
โ       โโโ formatters/
โ           โโโ number-formatter.ts    # ๐ ูุญุฏุฉ ุชูุณูู ุงูุฃุฑูุงู
โ       โโโ validators/
โ           โโโ number.validator.ts    # โ ูุญุฏูุซ
โ           โโโ phone.validator.ts     # โ ูุญุฏูุซ
โโโ bot/
โ   โโโ context.ts                     # โ ูุญุฏูุซ (SessionData)
โ   โโโ features/
โ       โโโ welcome.ts                 # โ ุฒุฑ ุงูุฅุนุฏุงุฏุงุช
โ       โโโ settings/                  # ๐ ูุธุงู ุงูุฅุนุฏุงุฏุงุช
โ           โโโ config.ts
โ           โโโ index.ts
โ           โโโ handlers/
โ               โโโ company-settings.ts
โ               โโโ features-toggle.ts
```

### ๐ ุงูุชูุงูู:

#### ูู `src/bot/context.ts`:
```typescript
export interface SessionData {
  awaitingInput?: {
    type: string
    messageId?: number
    data?: any
  }
}
```

#### ูู `src/bot/index.ts`:
```typescript
import { settingsFeatureComposer } from '#root/bot/features/settings/index.js'
// ...
protectedBot.use(settingsFeatureComposer)
```

---

## ๐ ุฃูุซูุฉ ุนูููุฉ

### 1. ุงุณุชุฎุฏุงู ุชุญููู ุงูุฃุฑูุงู ูู ูุนุงูุฌ:

```typescript
import { formatNumber, normalizeArabicNumbers } from '#root/modules/input/formatters/index.js'

// ูู ูุนุงูุฌ ุฅุฏุฎุงู ุงููุจูุบ
bot.on('message:text', async (ctx) => {
  const userInput = ctx.message.text // ูุฏ ูููู "ูกูขูฃูค" ุฃู "1234"
  const normalized = normalizeArabicNumbers(userInput)
  const amount = Number.parseFloat(normalized)

  await ctx.reply(`ุงููุจูุบ ุงูููุฏุฎู: ${formatNumber(amount)} ุฌููู`)
})
```

### 2. ุนุฑุถ ุชูุฑูุฑ ูุงูู:

```typescript
import { formatCurrency } from '#root/modules/input/formatters/index.js'

const report = {
  revenue: 1250000,
  expenses: 450000,
  profit: 800000,
}

await ctx.reply(
  `๐ **ุงูุชูุฑูุฑ ุงููุงูู**\n\n`
  + `๐ฐ ุงูุฅูุฑุงุฏุงุช: ${formatCurrency(report.revenue, 'EGP')}\n`
  + `๐ธ ุงููุตุฑููุงุช: ${formatCurrency(report.expenses, 'EGP')}\n`
  + `โ ุงูุฑุจุญ: ${formatCurrency(report.profit, 'EGP')}`,
  { parse_mode: 'Markdown' }
)
// ุงููุชูุฌุฉ:
// ๐ฐ ุงูุฅูุฑุงุฏุงุช: 1,250,000.00 EGP
// ๐ธ ุงููุตุฑููุงุช: 450,000.00 EGP
// โ ุงูุฑุจุญ: 800,000.00 EGP
```

### 3. ุงูุชุญูู ูู ุฑูู ุงููุงุชู (ุนุฑุจู/ุฅูุฌููุฒู):

```typescript
import { isValidEgyptPhone } from '#root/modules/input/validators/index.js'

bot.on('message:text', async (ctx) => {
  const phone = ctx.message.text

  if (isValidEgyptPhone(phone)) {
    await ctx.reply(`โ ุฑูู ุงููุงุชู ุตุญูุญ: ${phone}`)
  }
  else {
    await ctx.reply('โ ุฑูู ุงููุงุชู ุบูุฑ ุตุญูุญ')
  }
})

// ููุจู:
// - ููกููกูขูฃูคูฅูฆูงูจ
// - 01012345678
// - +201012345678
// - 00201012345678
```

---

## ๐จ ุชุฎุตูุต ุงูุฅุนุฏุงุฏุงุช

### ุฅุถุงูุฉ ุฅุนุฏุงุฏ ุฌุฏูุฏ:

1. **ูู `src/modules/settings/default-settings.ts`:**

```typescript
{
  key: 'company.address',
  scope: 'global',
  category: 'general',
  type: 'string',
  defaultValue: 'ุงููุงูุฑุฉุ ูุตุฑ',
  description: 'ุนููุงู ุงูุดุฑูุฉ',
  validation: {
    required: false,
    min: 5,
    max: 200,
  },
  isEditable: true,
  requiresRestart: false,
  group: 'company',
  order: 3,
},
```

2. **ุฅุถุงูุฉ ูุนุงูุฌ ูู Settings:**

```typescript
// ูู src/bot/features/settings/handlers/company-settings.ts
companySettingsHandler.callbackQuery('settings:company:edit-address', async (ctx) => {
  // ูุนุงูุฌ ุชุนุฏูู ุงูุนููุงู
})
```

3. **ุฅุถุงูุฉ ุฒุฑ ูู ุงููุงุฌูุฉ:**

```typescript
const keyboard = new InlineKeyboard()
  .text('โ๏ธ ุชุนุฏูู ุงุณู ุงูุดุฑูุฉ', 'settings:company:edit-name')
  .row()
  .text('๐ ุชุนุฏูู ุงูุนููุงู', 'settings:company:edit-address')
  .row()
```

---

## ๐ ุงูุตูุงุญูุงุช

| ุงูุฏูุฑ | ุงููุตูู ููุฅุนุฏุงุฏุงุช | ุชุนุฏูู ุงูุฃูุณุงู | ุนุฑุถ ุงูุฅุญุตุงุฆูุงุช |
|-------|-------------------|----------------|-----------------|
| **SUPER_ADMIN** | โ ูุงูู | โ | โ |
| **ADMIN** | โ | โ | โ |
| **USER** | โ | โ | โ |
| **GUEST** | โ | โ | โ |

---

## ๐ ุงูุงุฎุชุจุงุฑ

### ุงุฎุชุจุงุฑ ุงูุฃุฑูุงู ุงูุนุฑุจูุฉ:

```bash
# ูู ุจุฅุฏุฎุงู ุงูุฃุฑูุงู ุงูุชุงููุฉ ูู ุงูุจูุช:
ูกูขูฃูคูฅูฆูงูจูฉู
1234567890
ูก,ูขูฃูค,ูฅูฆูง
1,234,567
ูกูขูฃ.ูคูฅ
123.45
```

### ุงุฎุชุจุงุฑ ุงูุฅุนุฏุงุฏุงุช:

1. โ ุณุฌูู ุงูุฏุฎูู ูู SUPER_ADMIN
2. โ ุงุถุบุท ุฒุฑ "โ๏ธ ุงูุฅุนุฏุงุฏุงุช"
3. โ ุงุฎุชุฑ "๐ข ุจูุงูุงุช ุงูุดุฑูุฉ"
4. โ ุงุฎุชุฑ "โ๏ธ ุชุนุฏูู ุงุณู ุงูุดุฑูุฉ"
5. โ ุฃุฏุฎู ุงุณู ุฌุฏูุฏ
6. โ ุชุญูู ูู ุงูุชุญุฏูุซ ูู `/start`

### ุงุฎุชุจุงุฑ ุชูุนูู/ุฅููุงู ุงูุฃูุณุงู:

1. โ ุงุถุบุท "โ๏ธ ุงูุฅุนุฏุงุฏุงุช"
2. โ ุงุฎุชุฑ "๐ฏ ุชูุนูู/ุฅููุงู ุงูุฃูุณุงู"
3. โ ุงุถุบุท ุนูู ุฃู ูุณู ูุชุจุฏูู ุญุงูุชู
4. โ ุงุฑุฌุน ูููุงุฆูุฉ ุงูุฑุฆูุณูุฉ ูุชุญูู ูู ุงูุชุบููุฑ

---

## ๐ฏ ุงูุฎูุงุตุฉ

ุชู ุชุทููุฑ 3 ููุฒุงุช ุฑุฆูุณูุฉ:

1. โ **ุฏุนู ุงูุฃุฑูุงู ุงูุนุฑุจูุฉ/ุงูุฅูุฌููุฒูุฉ** ูู ุฌููุน ุญููู ุงูุฃุฑูุงู
2. โ **ุนุฑุถ ุงููุจุงูุบ ุจููุงุตู ุงูุขูุงู** (1,000 - 1,000,000)
3. โ **ูุธุงู ุฅุนุฏุงุฏุงุช ุดุงูู** ููุณูุจุฑ ุฃุฏูู ููุท

**ุฌููุน ุงูุชุบููุฑุงุช ูุชูุงููุฉ ูููุฎุชุจุฑุฉ ูุฌุงูุฒุฉ ููุงุณุชุฎุฏุงู!** ๐
