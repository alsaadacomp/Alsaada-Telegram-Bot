
# المشاكل الشائعة والحلول

أثناء إعداد وتشغيل الروبوت، قد تواجه بعض المشاكل الشائعة. هذا الدليل يهدف إلى مساعدتك في تحديد هذه المشاكل وتقديم حلول فعالة لها.

--- 

### 1. خطأ `Unauthorized: invalid token` عند بدء التشغيل

-   **المشكلة:** عند تشغيل الروبوت، يتوقف فجأة ويعرض خطأ يحتوي على كلمة `Unauthorized`.

-   **السبب:** هذا الخطأ يعني أن `BOT_TOKEN` الذي قدمته في ملف `.env` غير صالح أو غير صحيح. قد يكون التوكن منسوخًا بشكل خاطئ، أو قد تم إلغاؤه.

-   **الحل:**
    1.  تأكد من أنك نسخت `BOT_TOKEN` بالكامل وبشكل صحيح من **@BotFather**.
    2.  تحقق من عدم وجود أي مسافات أو أحرف إضافية في بداية أو نهاية التوكن.
    3.  إذا استمرت المشكلة، جرب إنشاء توكن جديد من **@BotFather** واستخدامه.

--- 

### 2. فشل تثبيت الاعتماديات أو بدء التشغيل بسبب إصدار Node.js

-   **المشكلة:** تظهر أخطاء أثناء تشغيل `npm install` أو `npm run dev` تتعلق بعدم التوافق.

-   **السبب:** يتطلب هذا القالب إصدار **Node.js 20.0.0** أو أحدث. إذا كنت تستخدم إصدارًا أقدم، فلن تعمل بعض الحزم بشكل صحيح.

-   **الحل:**
    1.  تحقق من إصدار Node.js الحالي لديك عن طريق تشغيل الأمر: `node -v`.
    2.  إذا كان الإصدار أقدم من 20.0.0، قم بتحديث Node.js إلى أحدث إصدار مستقر من [الموقع الرسمي](https://nodejs.org/).
    3.  بعد التحديث، احذف مجلد `node_modules` وملف `package-lock.json` ثم أعد تشغيل `npm install`.

--- 

### 3. الروبوت لا يعمل والمتغيرات البيئية مفقودة

-   **المشكلة:** يفشل الروبوت في البدء مع خطأ يشير إلى أن متغيرًا معينًا (مثل `BOT_TOKEN`) غير موجود.

-   **السبب:** قد تكون نسيت إنشاء ملف `.env`، أو أنك لم تقم بتكوين المتغيرات المطلوبة فيه.

-   **الحل:**
    1.  تأكد من وجود ملف باسم `.env` في المجلد الجذر للمشروع (وليس `.env.txt` أو أي اسم آخر).
    2.  تأكد من أنك قمت بنسخ محتوى `.env.example` إلى `.env`.
    3.  افتح ملف `.env` وتأكد من أن `BOT_TOKEN` له قيمة صحيحة.

--- 

### 4. خطأ `Port already in use` في وضع Webhook

-   **المشكلة:** عند تشغيل الروبوت في وضع `webhook`، يفشل الخادم في البدء مع خطأ مثل `EADDRINUSE`.

-   **السبب:** المنفذ (port) الذي يحاول الخادم استخدامه (المحدد في `SERVER_PORT` في ملف `.env`) مشغول بالفعل بواسطة تطبيق آخر على نظامك.

-   **الحل:**
    -   **الخيار 1:** قم بتغيير قيمة `SERVER_PORT` في ملف `.env` إلى منفذ آخر غير مستخدم (على سبيل المثال، `8080` أو `3000`).
    -   **الخيار 2:** ابحث عن العملية التي تستخدم المنفذ الحالي وقم بإيقافها إذا لم تكن ضرورية.

--- 

### 5. الروبوت لا يستجيب في وضع Webhook

-   **المشكلة:** الروبوت يعمل في وضع `webhook` دون أخطاء، لكنه لا يستجيب لأي رسائل على تليجرام.

-   **السبب:** غالبًا ما يكون السبب هو أن خوادم تليجرام لا يمكنها الوصول إلى عنوان URL الخاص بالـ webhook الخاص بك. قد يكون هذا بسبب جدار حماية (firewall) أو أنك تقوم بتشغيله على جهازك المحلي (localhost) دون استخدام نفق (tunnel).

-   **الحل:**
    1.  تأكد من أن `BOT_WEBHOOK` في ملف `.env` هو عنوان URL عام يمكن الوصول إليه من الإنترنت.
    2.  إذا كنت تختبر على جهازك المحلي، فيجب عليك استخدام أداة مثل **[ngrok](https://ngrok.com/)** لإنشاء نفق آمن وإنشاء عنوان URL عام يوجه الطلبات إلى جهازك المحلي.
    3.  تأكد من أن جدار الحماية على الخادم أو جهازك لا يمنع الطلبات الواردة على المنفذ الذي تستخدمه.

--- 

### 6. خطأ `Cannot find module`

-   **المشكلة:** يظهر خطأ يفيد بأنه لا يمكن العثور على وحدة (module) معينة عند بدء تشغيل الروبوت.

-   **السبب:** لم يتم تثبيت الاعتماديات (dependencies) بشكل صحيح أو أن مجلد `node_modules` تالف.

-   **الحل:**
    1.  تأكد من أنك قمت بتشغيل `npm install` في المجلد الجذر للمشروع.
    2.  إذا كنت قد قمت بذلك بالفعل، فجرب حذف مجلد `node_modules` وملف `package-lock.json` ثم أعد تشغيل `npm install` من جديد.

--- 

### 7. الأوامر الجديدة لا تظهر في قائمة أوامر تليجرام

-   **المشكلة:** لقد أضفت أمرًا جديدًا في الكود، لكنه لا يظهر في قائمة الأوامر (التي تظهر عند كتابة `/`) في تطبيق تليجرام.

-   **السبب:** قائمة الأوامر في تليجرام لا يتم تحديثها تلقائيًا. يجب عليك تشغيل الأمر `/setcommands` يدويًا لتحديثها.

-   **الحل:**
    1.  تأكد من أن حسابك مدرج في قائمة `BOT_ADMINS` في ملف `.env`.
    2.  أرسل الأمر `/setcommands` في محادثة خاصة مع الروبوت.
    3.  سيقوم الروبوت بتحديث قائمة الأوامر لدى خوادم تليجرام. قد تحتاج إلى إعادة تشغيل تطبيق تليجرام لرؤية التغييرات.
