/**
 * مولد اسم الشهرة التلقائي
 * يولد اسم الشهرة من أول اسمين مع مراعاة الأسماء المركبة العربية
 */

// الأسماء المركبة العربية الشائعة
const COMPOUND_ARABIC_NAMES = [
  'عبد الله', 'عبد الرحمن', 'عبد الرحيم', 'عبد الرزاق', 'عبد السلام',
  'عبد العزيز', 'عبد الغني', 'عبد الفتاح', 'عبد القادر', 'عبد الكريم',
  'عبد المجيد', 'عبد المطلب', 'عبد المنعم', 'عبد الواحد', 'عبد الوهاب',
  'أبو بكر', 'أبو الحسن', 'أبو الحسين', 'أبو القاسم', 'أبو الفضل',
  'أبو العباس', 'أبو جعفر', 'أبو طالب', 'أبو سعيد', 'أبو نصر',
  'أبو الوفا', 'أبو الهدى', 'أبو اليسر', 'أبو اليمن', 'أبو الوفاء',
  'محمد علي', 'محمد حسن', 'محمد حسين', 'محمد أحمد', 'محمد إبراهيم',
  'محمد عبد', 'محمد صالح', 'محمد سالم', 'محمد عثمان', 'محمد يوسف',
  'أحمد علي', 'أحمد حسن', 'أحمد حسين', 'أحمد محمد', 'أحمد إبراهيم',
  'علي محمد', 'علي أحمد', 'علي حسن', 'علي حسين', 'علي إبراهيم',
  'حسن محمد', 'حسن أحمد', 'حسن علي', 'حسن حسين', 'حسن إبراهيم',
  'حسين محمد', 'حسين أحمد', 'حسين علي', 'حسين حسن', 'حسين إبراهيم',
  'إبراهيم محمد', 'إبراهيم أحمد', 'إبراهيم علي', 'إبراهيم حسن', 'إبراهيم حسين',
  'يوسف محمد', 'يوسف أحمد', 'يوسف علي', 'يوسف حسن', 'يوسف حسين',
  'عثمان محمد', 'عثمان أحمد', 'عثمان علي', 'عثمان حسن', 'عثمان حسين',
  'صالح محمد', 'صالح أحمد', 'صالح علي', 'صالح حسن', 'صالح حسين',
  'سالم محمد', 'سالم أحمد', 'سالم علي', 'سالم حسن', 'سالم حسين',
  'عبد الله محمد', 'عبد الله أحمد', 'عبد الله علي', 'عبد الله حسن', 'عبد الله حسين',
  'عبد الرحمن محمد', 'عبد الرحمن أحمد', 'عبد الرحمن علي', 'عبد الرحمن حسن', 'عبد الرحمن حسين',
  'عبد العزيز محمد', 'عبد العزيز أحمد', 'عبد العزيز علي', 'عبد العزيز حسن', 'عبد العزيز حسين',
  'عبد الكريم محمد', 'عبد الكريم أحمد', 'عبد الكريم علي', 'عبد الكريم حسن', 'عبد الكريم حسين',
  'عبد القادر محمد', 'عبد القادر أحمد', 'عبد القادر علي', 'عبد القادر حسن', 'عبد القادر حسين',
  'عبد السلام محمد', 'عبد السلام أحمد', 'عبد السلام علي', 'عبد السلام حسن', 'عبد السلام حسين',
  'عبد الرزاق محمد', 'عبد الرزاق أحمد', 'عبد الرزاق علي', 'عبد الرزاق حسن', 'عبد الرزاق حسين',
  'عبد الغني محمد', 'عبد الغني أحمد', 'عبد الغني علي', 'عبد الغني حسن', 'عبد الغني حسين',
  'عبد الفتاح محمد', 'عبد الفتاح أحمد', 'عبد الفتاح علي', 'عبد الفتاح حسن', 'عبد الفتاح حسين',
  'عبد المجيد محمد', 'عبد المجيد أحمد', 'عبد المجيد علي', 'عبد المجيد حسن', 'عبد المجيد حسين',
  'عبد المطلب محمد', 'عبد المطلب أحمد', 'عبد المطلب علي', 'عبد المطلب حسن', 'عبد المطلب حسين',
  'عبد المنعم محمد', 'عبد المنعم أحمد', 'عبد المنعم علي', 'عبد المنعم حسن', 'عبد المنعم حسين',
  'عبد الواحد محمد', 'عبد الواحد أحمد', 'عبد الواحد علي', 'عبد الواحد حسن', 'عبد الواحد حسين',
  'عبد الوهاب محمد', 'عبد الوهاب أحمد', 'عبد الوهاب علي', 'عبد الوهاب حسن', 'عبد الوهاب حسين',
  'أبو بكر محمد', 'أبو بكر أحمد', 'أبو بكر علي', 'أبو بكر حسن', 'أبو بكر حسين',
  'أبو الحسن محمد', 'أبو الحسن أحمد', 'أبو الحسن علي', 'أبو الحسن حسن', 'أبو الحسن حسين',
  'أبو الحسين محمد', 'أبو الحسين أحمد', 'أبو الحسين علي', 'أبو الحسين حسن', 'أبو الحسين حسين',
  'أبو القاسم محمد', 'أبو القاسم أحمد', 'أبو القاسم علي', 'أبو القاسم حسن', 'أبو القاسم حسين',
  'أبو الفضل محمد', 'أبو الفضل أحمد', 'أبو الفضل علي', 'أبو الفضل حسن', 'أبو الفضل حسين',
  'أبو العباس محمد', 'أبو العباس أحمد', 'أبو العباس علي', 'أبو العباس حسن', 'أبو العباس حسين',
  'أبو جعفر محمد', 'أبو جعفر أحمد', 'أبو جعفر علي', 'أبو جعفر حسن', 'أبو جعفر حسين',
  'أبو طالب محمد', 'أبو طالب أحمد', 'أبو طالب علي', 'أبو طالب حسن', 'أبو طالب حسين',
  'أبو سعيد محمد', 'أبو سعيد أحمد', 'أبو سعيد علي', 'أبو سعيد حسن', 'أبو سعيد حسين',
  'أبو نصر محمد', 'أبو نصر أحمد', 'أبو نصر علي', 'أبو نصر حسن', 'أبو نصر حسين',
  'أبو الوفا محمد', 'أبو الوفا أحمد', 'أبو الوفا علي', 'أبو الوفا حسن', 'أبو الوفا حسين',
  'أبو الهدى محمد', 'أبو الهدى أحمد', 'أبو الهدى علي', 'أبو الهدى حسن', 'أبو الهدى حسين',
  'أبو اليسر محمد', 'أبو اليسر أحمد', 'أبو اليسر علي', 'أبو اليسر حسن', 'أبو اليسر حسين',
  'أبو اليمن محمد', 'أبو اليمن أحمد', 'أبو اليمن علي', 'أبو اليمن حسن', 'أبو اليمن حسين',
  'أبو الوفاء محمد', 'أبو الوفاء أحمد', 'أبو الوفاء علي', 'أبو الوفاء حسن', 'أبو الوفاء حسين'
]

/**
 * يولد اسم الشهرة من الاسم الكامل
 * @param fullName الاسم الكامل
 * @returns اسم الشهرة المولد
 */
export function generateNickname(fullName: string): string {
  if (!fullName || fullName.trim() === '') {
    return ''
  }

  // تنظيف الاسم من المسافات الزائدة
  const cleanName = fullName.trim().replace(/\s+/g, ' ')
  const nameParts = cleanName.split(' ')

  if (nameParts.length === 0) {
    return ''
  }

  // إذا كان الاسم جزء واحد فقط
  if (nameParts.length === 1) {
    return nameParts[0]
  }

  // البحث عن الأسماء المركبة
  for (const compoundName of COMPOUND_ARABIC_NAMES) {
    const compoundParts = compoundName.split(' ')
    
    // التحقق من أن الاسم يبدأ بالاسم المركب
    if (nameParts.length >= compoundParts.length) {
      let isMatch = true
      for (let i = 0; i < compoundParts.length; i++) {
        if (nameParts[i] !== compoundParts[i]) {
          isMatch = false
          break
        }
      }
      
      if (isMatch) {
        // إذا كان الاسم المركب هو أول جزءين، نأخذ الجزء الثالث أيضاً
        if (compoundParts.length === 2 && nameParts.length >= 3) {
          return `${compoundName} ${nameParts[2]}`
        }
        // إذا كان الاسم المركب هو أول ثلاثة أجزاء، نأخذ الجزء الرابع أيضاً
        else if (compoundParts.length === 3 && nameParts.length >= 4) {
          return `${compoundName} ${nameParts[3]}`
        }
        // وإلا نأخذ الاسم المركب فقط
        else {
          return compoundName
        }
      }
    }
  }

  // إذا لم نجد اسماً مركباً، نأخذ أول اسمين
  if (nameParts.length >= 2) {
    return `${nameParts[0]} ${nameParts[1]}`
  }

  // إذا كان الاسم جزء واحد فقط
  return nameParts[0]
}

/**
 * يتحقق من أن اسم الشهرة صحيح
 * @param nickname اسم الشهرة
 * @returns true إذا كان صحيحاً
 */
export function isValidNickname(nickname: string): boolean {
  if (!nickname || nickname.trim() === '') {
    return false
  }

  const cleanNickname = nickname.trim()
  
  // التحقق من أن الاسم لا يحتوي على أرقام أو رموز خاصة
  const hasInvalidChars = /[0-9!@#$%^&*()_+=\[\]{};':"\\|,.<>\/?]/.test(cleanNickname)
  
  if (hasInvalidChars) {
    return false
  }

  // التحقق من أن الاسم يحتوي على حروف عربية أو إنجليزية
  const hasValidChars = /[أ-يa-zA-Z]/.test(cleanNickname)
  
  return hasValidChars
}

/**
 * أمثلة على الاستخدام
 */
export const NICKNAME_EXAMPLES = {
  'عبد الله محمد علي': 'عبد الله محمد',
  'عبد الرحمن أحمد حسن': 'عبد الرحمن أحمد',
  'محمد علي حسن حسين': 'محمد علي',
  'أحمد محمد إبراهيم': 'أحمد محمد',
  'علي حسن حسين': 'علي حسن',
  'فاطمة محمد علي': 'فاطمة محمد',
  'عبد العزيز محمد أحمد': 'عبد العزيز محمد',
  'أبو بكر محمد علي': 'أبو بكر محمد',
  'محمد': 'محمد',
  'عبد الله': 'عبد الله'
}
